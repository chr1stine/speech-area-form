questions = [
    {
        "text":"Сосредотачивает взгляд на игрушке, книге или другом предмете от 30 секунд  (кроме предметов для стимуляции)",
        "age":"0-3",
        "sphere":"Когнитивные навыки"
    },
    {
        "text":"Наблюдает за предметами и за объектами (в том числе движущимися) , которые находятся на расстоянии 3 метра и более",
        "age":"3-6",
        "sphere":"Когнитивные навыки"
    },
    {
        "text":"Разнообразно (два и более способа) исследует предметы руками: трясет, крутит, переворачивает, нажимает на кнопки, толкает, тянет",
        "age":"6-9",
        "sphere":"Когнитивные навыки"
    },
    {
        "text":"Ищет предметы, ушедшие из поля  зрения",
        "age":"9-12",
        "sphere":"Когнитивные навыки"
    },
    {
        "text":"Функционально и без подсказок использует 5 разных предметов",
        "age":"12-15",
        "sphere":"Когнитивные навыки"
    },
    {
        "text":"Проявляет интерес к играм с причинно-следственной связью  (исключая самостимулятивные активности)",
        "age":"15-18",
        "sphere":"Когнитивные навыки"
    },
    {
        "text":"Может играть с игрушками инициируя сюжет в одно-два действия. Например, может посадить куклу на стул и покормить ее, посадить человечка в машину и скатить с горки. ",
        "age":"18-21",
        "sphere":"Когнитивные навыки"
    },
    {
        "text":"Тянется к предметам, которые расположены на небольшом расстоянии и хватает их",
        "age":"0-3",
        "sphere":"Моторные навыки"
    },
    {
        "text":"Перекладывает предметы из одной руки в другую",
        "age":"3-6",
        "sphere":"Моторные навыки"
    },
    {
        "text":"Использует обе руки для выполнения какого-либо действия или во время игры (одной рукой держит игрушку, а другой - манипулирует ею)",
        "age":"6-9",
        "sphere":"Моторные навыки"
    },
    {
        "text":"Умеет бросать мяч",
        "age":"9-12",
        "sphere":"Моторные навыки"
    },
    {
        "text":"Оставляет следы на бумаге (точки, круги, линии) с помощью какого-либо пишущего предмета",
        "age":"12-15",
        "sphere":"Моторные навыки"
    },
    {
        "text":"Открывает и закрывает разные емкости, в том числе с закручивающимися крышками",
        "age":"15-18",
        "sphere":"Моторные навыки"
    },
    {
        "text":"Поднимается и спускается по лестнице без поддержки",
        "age":"18-21",
        "sphere":"Моторные навыки"
    },
    {
        "text":"Поворачивает голову, чтобы определить источник звука  ",
        "age":"0-3",
        "sphere":"Понимание речи"
    },
    {
        "text":"Смотрит на человека, который говорит или жестикулирует",
        "age":"3-6",
        "sphere":"Понимание речи"
    },
    {
        "text":"Реагирует на инструкции из одного слова, которые даются в контексте ситуации",
        "age":"6-9",
        "sphere":"Понимание речи"
    },
    {
        "text":"Идентифицирует пять частей тела, когда их называют",
        "age":"9-12",
        "sphere":"Понимание речи"
    },
    {
        "text":"Понимает смысл 30-50 слов: показывает на картинке, находит в комнате, смотрит в сторону",
        "age":"12-15",
        "sphere":"Понимание речи"
    },
    {
        "text":"Может выполнить разные инструкции с разными предметами, которые находятся в поле зрения",
        "age":"15-18",
        "sphere":"Понимание речи"
    },
    {
        "text":"Справляется с заданием, для выполнения которого надо перейти в другую комнату или найти объект, который не находится в поле зрения ребенка. ",
        "age":"18-21",
        "sphere":"Понимание речи"
    },
    {
        "text":"Голосом выражает протест или недовольство происходящим, выражает  \"хватит\" и \"не нравится\", отворачиваясь или пытаясь оттолкнуть.",
        "age":"0-3",
        "sphere":"Навыки просьбы"
    },
    {
        "text":"Просит желаемое с помощью взгляда, и вокализации, и телодвижения",
        "age":"3-6",
        "sphere":"Навыки просьбы"
    },
    {
        "text":"Просит желаемое с помощью взгляда, и вокализации, и указательного жеста",
        "age":"6-9",
        "sphere":"Навыки просьбы"
    },
    {
        "text":"Указывает на предмет, находящийся в отдалении, чтобы его попросить",
        "age":"9-12",
        "sphere":"Навыки просьбы"
    },
    {
        "text":"Отвечает \"Да - Нет\"  или кивает-мотает головой, когда ему что-то предлагают.",
        "age":"12-15",
        "sphere":"Навыки просьбы"
    },
    {
        "text":"Просит при помощи символа: слово, редуцированное слово, которое всегда обозначает этот объект, изобразительный жест, карточка",
        "age":"15-18",
        "sphere":"Навыки просьбы"
    },
    {
        "text":"Может попросить при помощи комбинации двух символов: жестов, редуцированное слово, карточка",
        "age":"18-21",
        "sphere":"Навыки просьбы"
    },
    {
        "text":"Издает звуки в ответ на реплику взрослого",
        "age":"0-3",
        "sphere":"Совместное понимание"
    },
    {
        "text":"Участвует или улыбается во время совместной физической или социальной игры",
        "age":"3-6",
        "sphere":"Совместное понимание"
    },
    {
        "text":"Смотрит туда, куда взрослый указывает жестом",
        "age":"6-9",
        "sphere":"Совместное понимание"
    },
    {
        "text":" При виде чего-то нового, интересного или пугающего, привекает внимание взрослого к этому одновременно используя и взгляд, и звук, и жест ",
        "age":"9-12",
        "sphere":"Совместное понимание"
    },
    {
        "text":"Приносит взрослому понравившуюся игрушку, чтобы показать.",
        "age":"12-15",
        "sphere":"Совместное понимание"
    },
    {
        "text":"Направляет внимание взрослого к объекту, находящемуся в пространстве,  который заинтересовал ребенка для того, чтобы показать и получить реакцию взрослого, например, чтобы взрослый кивнул, восхитился или посмотрел в ту же сторону.",
        "age":"15-18",
        "sphere":"Совместное понимание"
    },
    {
        "text":"Смотрит на реакцию взрослого после своих поступков",
        "age":"18-21",
        "sphere":"Совместное понимание"
    },
    {
        "text":"Повторяет за взрослым действие с предметом",
        "age":"9-12",
        "sphere":"Имитация"
    },
    {
        "text":"Повторяет крупномоторное движение руками без предмета",
        "age":"12-15",
        "sphere":"Имитация"
    },
    {
        "text":"Повторяет действие через некоторое время после ситуации",
        "age":"15-18",
        "sphere":"Имитация"
    },
    {
        "text":"Повторяет мелкомоторное движение руками без предмета.",
        "age":"18-21",
        "sphere":"Имитация"
    },
    {
        "text":"Может обозначить символом: стабильным звуком, жестом, изображением 3-5 объектов",
        "age":"12-15",
        "sphere":"Лингвистические навыки"
    },
    {
        "text":"Умеет дуть",
        "age":"12-15",
        "sphere":"Навыки артикуляции"
    },
    {
        "text":"Может намеренно произнести слог с согласными, повторяя за вами или называя этими слогами какой-то объект ",
        "age":"15-18",
        "sphere":"Навыки артикуляции"
    },
    {
        "text":"Может намеренно произнести слова с двумя разными согласными, повторяя слова или называя этим словом объект",
        "age":"18-21",
        "sphere":"Навыки артикуляции"
    },
    {
        "text":"Может обозначить символом: стабильным звуком, жестом, изображением 3-5 объектов ",
        "age":"12-15",
        "sphere":"Лингвистические навыки"
    },
    {
        "text":"Может обозначить символом: стабильным звуком, жестом, изображением более 30 объектов",
        "age":"15-18",
        "sphere":"Лингвистические навыки"
    },
    {
        "text":"Может построить фразу из двух слов, объединив два символа (жест, картинка, слово) в любой комбинации",
        "age":"18-21",
        "sphere":"Лингвистические навыки"
    }
];

var spheres = {
  "Когнитивные навыки":0,
  "Моторные навыки":1,
  "Понимание речи":2,
  "Навыки просьбы":3,
  "Совместное понимание":4,
  "Имитация":5,
  "Навыки артикуляции":6,
  "Лингвистические навыки":7
};

var ages = {
  "0-3":6,
  "3-6":5,
  "6-9":4,
  "9-12":3,
  "12-15":2,
  "15-18":1,
  "18-21":0
};

var divs = [];

function check_if_all(){
    answers = $('input[type=radio]:checked');
    console.log(answers.length);
    if (answers.length == questions.length){
        let btn = document.getElementById("infoBtn");
        btn.disabled = false;
    }
}


function addQuestion(question){  
    //находим родителя 
    let parent = document.getElementById("form");
  
    //блок вопроса с ответами
    let div = document.createElement("div");
    
    div.setAttribute("id",spheres[question["sphere"]]+ages[question["age"]]);
    div.setAttribute("class","mx-5");
    //внутри блока тело вопроса
    let p = document.createElement("p");
    // h5.setAttribute("id",question["sphere"]+question["age"]);
    p.setAttribute("class","fs-5 fw-3");
    p.setAttribute("style","font-family: 'Nunito', Arial;");
    p.innerHTML = question["text"];
    div.appendChild(p);
  
    //варианты ответов
    let radio_group_div = document.createElement("div");
    radio_group_div.setAttribute("class","input_group mb-5");
    answers = ["Да","50/50","Нет"];  
  

    for(j = 0; j < 3; j++){
      let label = document.createElement("label");
      let button = document.createElement("input");
      button.setAttribute("type","radio");
      button.setAttribute("name","answer"+spheres[question["sphere"]]+ages[question["age"]]);
      button.setAttribute("id","answer"+spheres[question["sphere"]]+ages[question["age"]]+j);
      button.setAttribute("class","form-check-input");
      button.setAttribute("value",answers[j]);
      button.addEventListener('change', check_if_all);
      radio_group_div.appendChild(button);
      // по умолчанию все ответы - Нет
    //   if (j==2){
    //       button.checked = true;
    //   }else{

    //   }
      label.setAttribute("for","answer"+spheres[question["sphere"]]+ages[question["age"]]+j);
      label.setAttribute("class","mx-3 fs-5");
      label.setAttribute("style","font-family: 'Nunito', Arial;");
      label.innerHTML = answers[j];
    
      radio_group_div.appendChild(label);
      radio_group_div.appendChild(document.createElement("br"));
    }
    div.appendChild(radio_group_div);
  
      //добавляем блок вопроса-ответов к родителю
      parent.appendChild(div);
  }

$(document).ready(function() {
    questions.forEach(question => {
        addQuestion(question);
      });
});

function authorize(){
    //redirect on auth page
}

var size = 700;
function setup(){
  var myCanvas = createCanvas(size, size);
  myCanvas.parent("container");
}

var M = Array(8).fill(0).map(x=>Array(7).fill(0));

function infoGraphic(){

  for(i=0;i<Object.keys(spheres).length;i++){
      for(j=0;j<Object.keys(ages).length;j++){
        //в каждом div блоке выбрать только checked кнопка
        selected_answer = $('input[name=answer'+i+j+']:checked').val();
        console.log("value="+selected_answer);
            if (selected_answer=='Да') 
                M[i][j] = 3;
            else if (selected_answer=='50/50')
                M[i][j] = 2;
            else if (selected_answer=='Нет')
                M[i][j] = 1;
      }
    }

    draw();
}

function draw() {
    // let r = [140,120,100,80,60,40,20];
    clear();
    let r = [];
    for (j=6;j>=0;j--)
        r[6-j] = 0.05*size*(1+j);
    // i - сектора и сферы
    // j - радиусы и возраста
    // h - разделители сфер( ~i)
    // M - матрица значений от 0 до 2, строки - круговая ось, столбцы - ось от центра "наружу"
    // radius of age = 20+age*20
    x0 = size/2;
    y0 = size/2;

    //метки сфер
    let a = PI/8;
    let step = 2*PI/8;
    let offset = size/2 - 0.07*size;
    textFont('Nunito');
    textSize(size/40);
    textStyle(BOLD);
    strokeWeight(0);
    textAlign(CENTER,CENTER);
    for (const [key, value] of Object.entries(spheres)) {
        let str = key.toString();
        if (str.toString().includes(' ')){
            str = str.replace(' ','\n');
        }
        fill(0, 100, 150);
        text(str,x0-offset*sin(a), x0+offset*cos(a));
        a += step;
    }

    //цикл по радиусам(=возрастам) от большего к меньшему
    ellipseMode(RADIUS);
    fill(255);
    strokeWeight(2);
    stroke(0);
    for(j=0;j<Object.keys(ages).length;j++){ 

        //белый круг
        ellipse(x0,y0,r[j],r[j]);
        // fill(255);

        //начальный угод и шаг угла
        a = 0;
        step = 2*PI/8;

        //заполняем необходимые ячейки
        for(i=0;i<Object.keys(spheres).length;i++){
            // console.log('arc TO BE drawn at sphere '+i+' age '+j);
            switch(M[i][j]){
            case 2:
                // console.log('weak arc drawn at sphere '+i+' age '+j);
                fill(0,220,0);
                arc(x0,y0,r[j],r[j],PI/2+step*(i),PI/2+step*(i+1));
                fill(255);
                break;
            case 3:
                // console.log('strong arc drawn at sphere '+i+' age '+j);
                fill(0,120,10);
                arc(x0,y0,r[j],r[j],PI/2+step*(i),PI/2+step*(i+1));
                fill(255);
                break;
            //для не отвеченных/неотображаемых вопросов
            case 0:
                fill(230);
                arc(x0,y0,r[j],r[j],PI/2+step*(i),PI/2+step*(i+1));
                fill(255);
            }
        }

        //линии-разделители
        for(h=0;h<Object.keys(spheres).length;h++){
            line(x0, y0, x0-r[j]*sin(a), x0+r[j]*cos(a));
            a += step;
        }

    //переход к след радиусу
    }
    noLoop();
}